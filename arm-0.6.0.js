var gizmoJs=gizmoJs||{};
(function(){var a={is:function(a,c){if(this.isSet(c)){var e=Object.prototype.toString.call(c).slice(8,-1);return void 0!==c&&null!==c&&e===a}return!1},type:function(a){return{}.toString.call(a).slice(8,-1)},isSet:function(a){return void 0!=a&&null!=a?!0:!1},TNumberPos:function(a){if(this.isSet(a)&&0<=this.TNumber(a))return a;throw TypeError(a+" < 0 or is undefined");},TString:function(a){if(this.isSet(a)&&!0===this.is("String",a))return a;throw TypeError(this.type(a)+" != String");},TNumber:function(a){if(this.isSet(a)&&
!0===this.is("Number",a))return a;throw TypeError(this.type(a)+" != Number");},TBool:function(a){if(this.isSet(a)&&!0===this.is("Boolean",a))return a;throw TypeError(this.type(a)+" != Boolean");},TArray:function(a){if(this.isSet(a)&&!0===this.is("Array",a))return a;throw TypeError(this.type(a)+" != Array");},TFunc:function(a){if(this.isSet(a)&&!0===this.is("Function",a))return a;throw TypeError(this.type(a)+" != Function");},TDate:function(a){if(this.isSet(a)&&!0===this.is("Date",a))return a;throw TypeError(this.type(a)+
" != Date");},TRegExp:function(a){if(this.isSet(a)&&!0===this.is("RegExp",a))return a;throw TypeError(this.type(a)+" != RegExp");},TObject:function(a){if(this.isSet(a)&&!0===this.is("Object",a))return a;throw TypeError(this.type(a)+" != Object");},TArmObject:function(a){if(this.isSet(a)&&!0===this.is("Object",a)&&"object"==a.type)return a;throw TypeError(this.type(a)+" != ArmObject");},TArmShape:function(a){if(this.isSet(a)&&!0===this.is("Object",a)&&"shape"==a.type)return a;throw TypeError(this.type(a)+
" != ArmShape");},TPoint:function(a){if(this.isSet(a)&&!0===this.is("Object",a)&&isTNumber(a.x)&&isTNumber(a.y))return a;throw TypeError(this.type(a)+" != TPoint");}};gizmoJs.Type=a;gizmoJs.Class=function(a){var c=a.construct||function(){};if(a.base){var e=a.base,g=function(){};g.prototype=e.prototype;c.prototype=new g;c.prototype.constructor=c;for(var d in e)if("prototype"!=d){var g=e.__lookupGetter__(d),f=e.__lookupSetter__(d);g||f?(g&&c.__defineGetter__(d,g),f&&c.__defineSetter__(d,f)):c[d]=e[d]}g=
function(){var a=this;if(1<arguments.length)throw Error("$base requires 0-1 parameters.");var b,c=a.$base;a.$base=e.__$base;if(1===arguments.length){var d=arguments[0];b=function(){if(e.prototype[d]){var b=e.prototype[d].apply(a,arguments);a.$base=c;return b}throw Error("Method '"+d+"' not found.");}}else 0===arguments.length&&(b=function(){e.apply(a,arguments);a.$base=c});return b};c.__$base=g;c.prototype.$base=g}var i=a.methods||{};for(d in i)g=i.__lookupGetter__(d),f=i.__lookupSetter__(d),g||f?
(g&&c.prototype.__defineGetter__(d,g),f&&c.prototype.__defineSetter__(d,f)):c.prototype[d]=i[d];var h=a.vars||{};for(d in h)c.prototype["_"+d]=h[d],g=function(){var a="_"+d;switch(type(h[d])){case "String":return function(){return TString(this[a])};case "Number":return function(){return TNumber(this[a])};case "Boolean":return function(){return TBool(this[a])};case "Array":return function(){return TArray(this[a])};case "Date":return function(){return TDate(this[a])};default:return function(){return this[a]}}}(d),
f=function(){var a="_"+d;switch(type(h[d])){case "String":return function(b){this[a]=TString(b)};case "Number":return function(b){this[a]=TNumber(b)};case "Boolean":return function(b){this[a]=TBool(b)};case "Array":return function(b){this[a]=TArray(b)};case "Date":return function(b){this[a]=TDate(b)};default:return function(b){this[a]=b}}}(d),c.prototype.__defineGetter__(d,g),c.prototype.__defineSetter__(d,f);a=a.statics||{};for(d in a)c[d]=a[d];return c};return function(){window.gizmoJs=gizmoJs;
window.Type=gizmoJs.Type;window.TString=window.Type.TString;window.TNumber=window.Type.TNumber;window.is=window.Type.is;window.type=window.Type.type;window.isSet=window.Type.isSet;window.TNumberPos=window.Type.TNumberPos;window.TBool=window.Type.TBool;window.TArray=window.Type.TArray;window.TFunc=window.Type.TFunc;window.TDate=window.Type.TDate;window.TRegExp=window.Type.TRegExp;window.TObject=window.Type.TObject;window.TArmObject=window.Type.TArmObject;window.TArmShape=window.Type.TArmShape;window.TPoint=
window.Type.TPoint;window.isTString=function(b){return a.is("String",b)?!0:!1};window.isTNumber=function(b){return a.is("Number",b)?!0:!1};window.isTNumberPos=function(b){return a.is("Number",b)&&0<=b?!0:!1};window.isTBool=function(b){return a.is("Boolean",b)};window.isTArray=function(b){return a.is("Array",b)};window.isTFunc=function(b){return a.is("Function",b)};window.isTDate=function(b){return a.is("Date",b)};window.isTRegExp=function(b){return a.is("RegExp",b)};window.isTObject=function(b){return a.is("Object",
b)};window.isTArmObject=function(b){return a.isSet(b)&&a.is("Object",b)&&a.isSet(b.type)&&"object"==b.type?!0:!1};window.isTArmShape=function(b){return a.isSet(b)&&a.is("Object",b)&&a.isSet(b.type)&&"shape"==b.type?!0:!1};window.isTPoint=function(a){return this.isSet(a)&&!0===this.is("Object",a)&&isTNumber(a.x)&&isTNumber(a.y)?!0:!1};window.Class=gizmoJs.Class}})()();var CSuperObj=Class({construct:function(){},vars:{context:null,x:0,y:0,globalCenter:{x:0,y:0},localCenter:{x:0,y:0},center:{x:0,y:0},angel:0,globalAngel:0,localAngel:0,rotateCenter:{x:0,y:0},localRotateCenter:{x:0,y:0}},methods:{clone:function(){var a=[],b=function(c){if(null==c||"object"!=typeof c)return c;for(var e in a)if(a[e]==c)return c;a.push(c);if(isTFunc(c.constructor)&&"HTMLCollection"!=type(c)){e=new c.constructor;for(var g in c)if(c.hasOwnProperty(g))if("_context"==g)e[g]=c[g];else{var d=
c.__lookupGetter__(g),f=c.__lookupSetter__(g);d||f?(d&&e.prototype.__defineGetter__(g,d),f&&e.prototype.__defineSetter__(g,f)):e[g]=b(c[g])}}else return c;delete e.name;return e};return b(this)}}});var CObject=Class({base:CSuperObj,construct:function(a){if(isSet(a)){this.name=a.name||this.name;isTPoint(a.center)&&(this.x=a.center.x,this.y=a.center.y,this.globalCenter={x:a.center.x,y:a.center.y},this.localCenter={x:a.center.x,y:a.center.y});isTNumber(a.x)&&(this.x=a.x);isTNumber(a.y)&&(this.y=a.y);isTPoint(a.rotateCenter)&&(this.rotateCenter={x:a.rotateCenter.x,y:a.rotateCenter.y},this.localRotateCenter={x:a.rotateCenter.x,y:a.rotateCenter.y});isTNumberPos(a.angel)&&(this.angel=this.localAngel=
this.globalAngel=a.angel);if(isTArray(a.collection)){this.collection=[];for(var b in a.collection)(isTArmShape(a.collection[b])||isTArmObject(a.collection[b]))&&this.add(a.collection[b])}if(isTArray(a.skeleton)){var c=[],e=a.skeleton;for(b in e){var g=e[b].x0,d=e[b].y0,f=e[b].x1,i=e[b].y1;c.push({p0:[g,d,1],p1:[f,i,1]})}this.segments=this.nativeSegments=c;this.functions=[];e=this.nativeSegments;for(b in e)c=e[b].p0[1]-e[b].p1[1],d=e[b].p1[0]-e[b].p0[0]+1E-5,i=e[b].p0[0]*e[b].p1[1]-e[b].p1[0]*e[b].p0[1],
g=e[b].p0[0],f=e[b].p1[0],this.functions.push({A:c,B:d,C:i,x0:g,x1:f});var h=this.globalCenter,c=[];for(b in this.nativeSegments)e=this.nativeSegments[b],g=e.p0[0]+h.x,d=e.p0[1]+h.y,f=e.p1[0]+h.x,i=e.p1[1]+h.y,c.push({p0:[g,d,1],p1:[f,i,1]});this.segments=c}if(isTObject(a.vars))for(var j in a.vars)this[j]=a.vars[j];isTFunc(a.begin)&&(this.begin=a.begin);isTFunc(a.update)&&(this.update=a.update);if(isTObject(a.events))for(b in a.events)isTFunc(a.events[b])&&(this.events=this.events||{},this.events[b]=
a.events[b])}},vars:{collection:[],skeleton:{},segments:[],nativeSegments:[],functions:[],name:"undefined",type:"object"},methods:{add:function(a){if(isTArmObject(a)||isTArmShape(a))a.context=this.context,a.x+=this.x,a.Y+=this.y,a.globalCenter.x=a.localCenter.x+this.globalCenter.x,a.globalCenter.y=a.localCenter.y+this.globalCenter.y,a.rotateCenter={x:this.rotateCenter.x,y:this.rotateCenter.y},a.localRotateCenter={x:this.rotateCenter.x,y:this.rotateCenter.y},a.globalAngel=a.localAngel+this.globalAngel,
a.angel=a.globalAngel,this.collection.push(a),isSet(a.name)&&(this[a.name]=a);else throw Error("Object: add() -> Incorrect object!");},remove:function(a){try{if(isTArmObject(a)||isTArmShape(a))for(var b in this.collection)this.collection[b]==a&&delete this.collection[b];else throw Error("Object: remove(O) -> O is not shape or object!");}catch(c){console.log(c)}},set context(a){this._context=a;for(var b in this.collection)this.collection[b].context=a},get context(){return this._context},_begin:function(a){"function"==
typeof this.begin&&this.begin.call(this,a);for(var b in this.collection){var c=this.collection[b];"function"==typeof c.begin&&c!=this&&c.begin.call(c,a)}},_clean:function(a){for(var b in this.collection){var c=this.collection[b];c._clean.call(c,a)}},_updateSkeleton:function(){for(var a in this.collection){var b=this.collection[a];this.globalCenter={x:this.x,y:this.y};this.globalAngel=this.angel;this.rotateCenter={x:this.localRotateCenter.x+this.x,y:this.localRotateCenter.y+this.y};b.x=this.x+b.localCenter.x;
b.y=this.y+b.localCenter.y;b.globalCenter={x:b.x,y:b.y};b.rotateCenter=this.rotateCenter;b.globalAngel=this.angel+b.localAngel;b.angel=b.globalAngel}this.functions=[];b=this.segments;for(a in b){var c=b[a].p0[0],e=b[a].p1[0];this.functions.push({A:b[a].p0[1]-b[a].p1[1],B:b[a].p1[0]-b[a].p0[0]+1E-5,C:b[a].p0[0]*b[a].p1[1]-b[a].p1[0]*b[a].p0[1],x0:c,x1:e})}var g=this.globalCenter,d=[];for(a in this.nativeSegments){var b=this.nativeSegments[a],c=b.p0[0]+g.x,f=b.p0[1]+g.y,e=b.p1[0]+g.x;d.push({p0:[c,
f,1],p1:[e,b.p1[1]+g.y,1]})}this.segments=d},_update:function(a,b){isTFunc(this.update)&&this.update.call(this,a,b);this._updateSkeleton.call(this,a);for(var c in this.collection){var e=this.collection[c];e.update&&e.update.call(e,a)}},_draw:function(a){for(var b in this.collection){var c=this.collection[b];c._draw.call(c,a)}},_info:function(a){a.context.beginPath();for(var b in this.segments)a.context.moveTo(this.segments[b].p0[0],this.segments[b].p0[1]),a.context.lineTo(this.segments[b].p1[0],this.segments[b].p1[1]),
a.context.lineWidth=1,a.context.strokeStyle="#0f0";a.context.moveTo(this.rotateCenter.x,this.rotateCenter.y);a.context.arc(this.rotateCenter.x,this.rotateCenter.y,2,2*Math.PI,!1);this.context.stroke();this.context.fillStyle="#a00";this.context.fill();a.context.closePath();a.context.beginPath();a.context.moveTo(this.globalCenter.x,this.globalCenter.y);a.context.arc(this.globalCenter.x,this.globalCenter.y,2,2*Math.PI,!1);this.context.fillStyle="#abc";a.context.font="bold 14px 'sans-serif'";a.context.fillText(this.name,
this.globalCenter.x+10,this.globalCenter.y);this.context.stroke();this.context.fillStyle="#abc";this.context.fill();a.context.closePath();for(b in this.collection)a=this.collection[b],"function"==typeof a._info&&a._info.call(a,this)},_event:function(a){for(var b in this.collection)"function"==typeof this.collection[b]._event&&this.collection[b]._event.call(this.collection[b],a)},_onkeydown:function(a,b){isSet(this.events)&&isTFunc(this.events.onkeydown)&&this.events.onkeydown.call(this,a,b);for(var c in this.collection){var e=
this.collection[c];"function"==typeof e._onkeydown&&(e=this.collection[c],e._onkeydown.call(e,a,b))}}}});CShape=Class({base:CSuperObj,construct:function(){},vars:{x:0,y:0,stroke:"black",lineWidth:1,shapeType:"shape",type:"shape"},methods:{}});var CRect=Class({base:CShape,construct:function(a){"undefined"!=typeof a&&(this.x=a.x||this.x,this.y=a.y||this.y,this.angel=a.angel||this.angel,this.stroke=a.stroke||this.stroke,this.fill=a.fill||this.fill,this.context=a.context||this.context,this.name=a.name||this.name,"undefined"!=typeof a.width&&0<a.width&&(this.width=a.width),"undefined"!=typeof a.height&&0<a.height&&(this.height=a.height),"undefined"!=typeof a.lineWidth&&0<a.lineWidth&&(this.lineWidth=a.lineWidth))},vars:{width:100,height:100,
fill:"gray",shapeType:"rect"},methods:{_clean:function(){},_draw:function(){this.context.save();this.context.translate(this.x+this.width/2,this.y+this.height/2);this.context.rotate(this.angel*Math.PI/180);this.context.translate(-(this.x+this.width/2),-(this.y+this.height/2));this.context.beginPath();this.context.rect(this.x,this.y,this.width,this.height);this.context.closePath();this.context.fillStyle=this.fill;this.context.lineWidth=this.lineWidth;this.context.strokeStyle=this.stroke;this.context.fill();
this.context.stroke();this.context.restore()}}});var CCircle=Class({base:CShape,construct:function(a){"undefined"!=typeof a&&("number"==typeof a.x&&(this.x=a.x),"number"==typeof a.y&&(this.y=a.y),"string"==typeof a.stroke&&(this.x=a.stroke),"string"==typeof a.fill&&(this.fill=a.fill),"undefined"!=typeof a.name&&(this.name=a.name),"undefined"!=typeof a.context&&(this.x=a.stroke),"undefined"!=typeof a.radius&&0<a.radius&&(this.radius=a.radius),"undefined"!=typeof a.lineWidth&&0<a.lineWidth&&(this.lineWidth=a.lineWidth))},vars:{radius:100,fill:"gray",
shapeType:"circle"},methods:{_clean:function(){this.context.clearRect(this.x-this.radius-this.lineWidth,this.y-this.radius-this.lineWidth,this.x+this.radius+this.lineWidth,this.y+this.radius+this.lineWidth)},_draw:function(){this.context.beginPath();this.context.arc(this.x,this.y,this.radius,0,2*Math.PI,!1);this.context.closePath();this.context.fillStyle=this.fill;this.context.fill();this.context.lineWidth=this.lineWidth;this.context.strokeStyle=this.stroke;this.context.stroke()}}});CImage=Class({base:CShape,construct:function(a){if("undefined"!=typeof a){this.x=a.x||this.x;this.y=a.y||this.y;this.localCenter={x:this.x,y:this.y};this.globalCenter={x:this.x,y:this.y};this.globalAngel=this.localAngel=a.angel||this.localAngel;this.rotateCenter=a.rotateCenter||this.rotateCenter;this.image=a.image||this.image;if(isSet(a.src)&&isTString(a.src)){var b=a.src,c=this,e=new Image;e.src=b;e.onload=function(){c.image=e;c.onload=!0}}this.context=a.context||this.context;this.name=a.name||this.name;
this.width=a.width;this.height=a.height}},vars:{width:100,height:100,image:new Image,onload:!1,shapeType:"image"},methods:{_clean:function(){},_draw:function(){!0==this.onload&&(this.context.save(),this.context.translate(this.rotateCenter.x,this.rotateCenter.y),this.context.rotate(this.globalAngel*Math.PI/180),this.context.translate(-this.rotateCenter.x,-this.rotateCenter.y),this.context.drawImage(this.image,this.x,this.y,this.width,this.height),this.context.restore())}}});var CLine=Class({base:CShape,construct:function(a){"undefined"!=typeof a&&(this.x0=a.x0||this.x,this.y0=a.y0||this.y,this.x1=a.x1||this.x+100,this.y1=a.y1||this.y+100,this.stroke=a.stroke||this.stroke,this.context=a.context||this.context,this.name=a.name||this.name,"undefined"!=typeof a.lineWidth&&0<a.lineWidth&&(this.lineWidth=a.lineWidth))},vars:{x0:10,y0:10,x1:100,y1:100,shapeType:"line"},methods:{_clean:function(){},_draw:function(){this.context.beginPath();this.context.moveTo(this.x0,this.y0);
this.context.lineTo(this.x1,this.y1);this.context.closePath();this.context.lineWidth=this.lineWidth;this.context.strokeStyle=this.stroke;this.context.stroke()}}});var CText=Class({base:CShape,construct:function(a){"undefined"!=typeof a&&(this.x=a.x||this.x,this.y=a.y||this.y,this.localCenter={x:this.x,y:this.y},this.globalCenter={x:this.x,y:this.y},this.globalAngel=this.localAngel=a.angel||this.localAngel,this.rotateCenter=a.rotateCenter||this.rotateCenter,this.text=a.text||this.text,this.font=a.font||this.font,this.size=a.size||this.size,this.stroke=a.stroke||this.stroke,this.fill=a.fill||this.fill,this.context=a.context||this.context,this.name=a.name||this.name)},
vars:{x:10,y:10,text:"text",font:"50px Tahoma",size:75,textAlign:"left",fill:"gray",shapeType:"text"},methods:{_clean:function(){},_draw:function(){this.context.save();this.context.translate(this.rotateCenter.x,this.rotateCenter.y);this.context.rotate(this.globalAngel*Math.PI/180);this.context.translate(-this.rotateCenter.x,-this.rotateCenter.y);this.context.strokeStyle=this.stroke;this.context.fillStyle=this.fill;this.context.font=this.size+"px '"+this.font+"'";this.context.fillText(this.text,this.x,
this.y);this.context.restore()}}});var CStage=Class({construct:function(a){this.fps=a.fps||this.fps;this.width=a.width||this.width;this.height=a.height||this.height;if(a.container){var a=document.getElementById(a.container),b=document.createElement("canvas");b.width=this.width;b.height=this.height;b.style.id="2k2nd";a.appendChild(b);this.context=b.getContext("2d")}else throw Error("The container is not found! Choose right name of container, please!");this._init()},vars:{collection:[],collectionObjects:[],context:{},events:{},fps:10,
intervalId:null,finfo:!1,width:500,height:500,TICKS_PER_SECOND:30,SKIP_TICKS:33,MAX_FRAMESKIP:5,next_game_tick:1*new Date},methods:{add:function(a){if("object"==typeof a&&("shape"==a.type||"object"==a.type))a.context=this.context,this.collection.push(a),this.addObjCollection(a);else throw Error("Stage: add(O) -> O is not shape or object!");},remove:function(a){if("object"==typeof a&&("shape"==a.type||"object"==a.type))for(var b in this.collection)this.collection[b]==a&&delete this.collection[b];else throw Error("Stage: remove(O) -> O is not shape or object!");
},addObjCollection:function(a){if(isTArmObject(a)){for(var b in a.collection)isTArmObject(a.collection)&&this.addObjCollection(a.collection);this.collectionObjects.push(a)}},_init:function(){var a=this;document.onkeydown=function(b){a._onkeydown(b)}},_begin:function(a){for(var b in this.collection){var c=this.collection[b];"function"==typeof c._begin&&c._begin.call(c,a)}},_clean:function(a){this.context.clearRect(0,0,a.width,a.height)},_updateSkeleton:function(a){for(var b in this.collection){var c=
this.collection[b];"function"==typeof c._updateSkeleton&&c._updateSkeleton.call(c,a)}},_update:function(a,b){for(var c in this.collection){var e=this.collection[c];"function"==typeof e._update&&e._update.call(e,a,b)}},_draw:function(a){for(var b in this.collection){var c=this.collection[b];"function"==typeof c._draw&&c._draw.call(c,a)}},_info:function(){if(!0==this.finfo)for(var a in this.collection){var b=this.collection[a];"function"==typeof b._info&&b._info.call(b,this)}},_event:function(a){for(var b in this.collectionObjects){var c=
this.collectionObjects[b];if(isSet(c.events)&&isTFunc(c.events.collision))for(var e in this.collectionObjects){var g=this.collectionObjects[e];if(c!=g){var d=this.__collision(c,g);!0==d.flag&&c.events.collision.call(c,g,d.points,a)}}}},__collision:function(a,b){var c=[],e;for(e in a.functions)for(var g in b.functions){var d;d=a.functions[e];var f=b.functions[g];if(f.x0>=d.x0&&f.x0<=d.x1||f.x1>=d.x0&&f.x1<=d.x1||d.x0>=f.x0&&d.x0<=f.x1||d.x1>=f.x0&&d.x1<=f.x1){var i=d.A*f.B-d.B*f.A;if(1E-8>Math.abs(i))d=
{flag:!1};else{var h=-(d.C*f.B-d.B*f.C)/i;d=(d.x0<d.x1&&h>=d.x0&&h<=d.x1||d.x0>d.x1&&h>=d.x1&&h<=d.x0)&&(f.x0<f.x1&&h>=f.x0&&h<=f.x1||f.x0>f.x1&&h>=f.x1&&h<=f.x0)?{x:h,y:-(d.A*f.C-d.C*f.A)/i,flag:!0}:{flag:!1}}}else d={flag:!1};d.flag&&c.push({x:d.x,y:d.y})}return 0<c.length?{flag:!0,points:c}:{flag:!1}},_onkeydown:function(a){for(var b in this.collection){var c=this.collection[b];isTFunc(c._onkeydown)&&c._onkeydown.call(c,a,this)}},_process:function(){stats.begin();this._clean.call(this,this);for(var a=
(1*new Date+this.SKIP_TICKS-this.next_game_tick)/this.SKIP_TICKS,b=0;1*new Date>this.next_game_tick&&b<this.MAX_FRAMESKIP;)this._update.call(this,this,a),this.next_game_tick+=this.SKIP_TICKS,b++;this._draw.call(this,this);for(a=0;a<b;a++)this._info.call(this,this),this._event.call(this,this);stats.end()},run:function(){this._begin.call(this,this);var a=this;if(this.intervalId=setInterval(function(){a._process.call(a)},1E3/this.fps))console.log("Stage, run()");else throw Error("Stage, can't run!");
},stop:function(){try{clearInterval(this.intervalId),console.log("Stage, stop()")}catch(a){console.log(a)}},info:function(){this.finfo=!1==this.finfo?!0:!1;console.log("Stage, info()");return null}}});
