function Class(a){var b=a.construct||function(){};if(a.base){var c=a.base,d=function(){};d.prototype=c.prototype;b.prototype=new d;b.prototype.constructor=b;for(var e in c)"prototype"!=e&&(b[e]=c[e]);d=function(){var a=this;if(1<arguments.length)throw Error("$base requires 0-1 parameters.");var b,d=a.$base;a.$base=c.__$base;if(1===arguments.length){var e=arguments[0];b=function(){if(c.prototype[e]){var b=c.prototype[e].apply(a,arguments);a.$base=d;return b}throw Error("Method '"+e+"' not found.");
}}else 0===arguments.length&&(b=function(){c.apply(a,arguments);a.$base=d});return b};b.__$base=d;b.prototype.$base=d}d=a.methods||{};for(e in d)b.prototype[e]=d[e];d=a.vars||{};for(e in d)b.prototype[e]=d[e];a=a.statics||{};for(e in a)b[e]=a[e];return b};CSuperObj=Class({construct:function(){},vars:{context:null,x:0,y:0},methods:{setX:function(a){this.x=a},setY:function(a){this.y=a},getX:function(){return this.x},getY:function(){return this.y},setContext:function(a){this.context=a},getContext:function(){return this.context},clone:function(){var a=[],b=function(c){if(null==c||"object"!=typeof c)return c;var d=!1,e;for(e in a)if(a[e]==c){d=!0;break}if(d)return c;a.push(c);if("function"==typeof c.constructor){var d=new c.constructor,f;for(f in c)c.hasOwnProperty(f)&&
(d[f]="context"==f?c[f]:b(c[f]))}else d=c;return d};return b(this)}}});var CObject=Class({base:CSuperObj,construct:function(a){if("undefined"!=typeof a){if("object"==typeof a.vars)for(var b in a.vars)this[b]=a.vars[b];"function"==typeof a.begin&&(this.__begin=a.begin);"function"==typeof a.update&&(this.__update=a.update);this.collection=[];if("object"==typeof a.collection&&a.collection instanceof Array&&1<=a.collection.length)for(var c in a.collection)("shape"==a.collection[c].type||"object"==a.collection[c].type)&&this.add(a.collection[c]);if("object"==typeof a.events)for(c in a.events)"function"==
typeof a.events[c]&&(this[c]=a.events[c])}},vars:{collection:[],type:"object"},methods:{add:function(a){if("object"==typeof a&&("shape"==a.type||"object"==a.type))a.setContext(this.context),this.collection.push(a);else throw Error("Object: add() -> Incorrect object!");},remove:function(a){if("object"==typeof a&&("shape"==a.type||"object"==a.type))for(var b in this.collection)this.collection[b]==a&&delete this.collection[b]},removeLast:function(){return this.collection.pop()},setCollection:function(a){if("object"==
typeof a)for(var b in a)("shape"==a[b].type||"object"==a[b].type)&&this.add(a[b])},getCollection:function(){return this.collection},setContext:function(a){this.context=a;for(var b in this.collection)this.collection[b].setContext(a)},_draw:function(a){for(var b in this.collection)this.collection[b]._draw.call(this.collection[b],a)},_clean:function(a){for(var b in this.collection)this.collection[b]._clean.call(this.collection[b],a)},_update:function(a){"function"==typeof this.__update&&this.__update.call(this,
a);for(var b in this.collection)"function"==typeof this.collection[b]._update&&this.collection[b]._update.call(this.collection[b],a)},_begin:function(a){"function"==typeof this.__begin&&this.__begin.call(this,a);for(var b in this.collection)"function"==typeof this.collection[b]._begin&&this.collection[b]._begin.call(this.collection[b],a)},__intersection:function(a){var b=function(a,b){var c=a.x-a.lineWidth,d=a.x+a.width+a.lineWidth,e=a.y-a.lineWidth,f=a.y+a.height+a.lineWidth,h=b.x-b.lineWidth,g=
b.x+b.width+b.lineWidth,k=b.y-b.lineWidth,l=b.y+b.height+b.lineWidth;if(h>=c&&g<=d||h>=c&&g>=d&&h<=d||h<=c&&g<=d&&g>=c||h<=c&&g>=d)if(k>=e&&l<=f||k>=e&&l>=f&&k<=f||k<=e&&l<=f&&l>=e||k<=e&&l>=f)return!0;return!1},c=function(a,b){var c=a.y,d=a.radius,e=b.y,f=b.radius;return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(c-e,2))<=d+f?!0:!1},d=function(a,e){for(var f in a.collection){var g=a.collection[f],j;for(j in e.collection){var i=e.collection[j];if(g!=i)return"rect"==g.shapeType&&"rect"==i.shapeType&&!1==
h?b(g,i)||!1:"circle"==g.shapeType&&"circle"==i.shapeType&&!1==h?c(g,i)||!1:"object"==g.type&&"object"==i.type&&!1==h?d(g,i)||!1:!1}}},e;for(e in this.collection){var f=this.collection[e],j;for(j in this.collection){var g=this.collection[j];if(g!=f){var h=!1;"rect"==f.shapeType&&("rect"==g.shapeType&&!1==h)&&(h=b(f,g)||!1);"circle"==f.shapeType&&("circle"==g.shapeType&&!1==h)&&(h=c(f,g)||!1);"object"==f.type&&("object"==g.type&&!1==h)&&(h=d(f,g)||!1);h&&"function"==typeof this.intersection&&this.intersection.call(this,
f,g,a)}}}},__mouse_move:function(){},_event:function(a){this.__intersection.call(this,a);this.__mouse_move.call(this,a);for(var b in this.collection)"function"==typeof this.collection[b]._event&&this.collection[b]._event.call(this.collection[b],a)},_onkeydown:function(a,b){"function"==typeof this.onkeydown&&this.onkeydown.call(d,a,b);for(var c in this.collection){var d=this.collection[c];"function"==typeof d._onkeydown&&d._onkeydown.call(d,a,b)}}}});CShape=Class({base:CSuperObj,construct:function(){},vars:{parent:"no",stroke:"black",lineWidth:1,type:"shape"},methods:{setStroke:function(a){this.stroke=a},getStroke:function(){return this.stroke},setLineWidth:function(a){this.lineWidth=a},getLineWidth:function(){return this.lineWidth}}});var CRect=Class({base:CShape,construct:function(a){"undefined"!=typeof a&&(this.x=a.x||this.x,this.y=a.y||this.y,this.stroke=a.stroke||this.stroke,this.fill=a.fill||this.fill,this.context=a.context||this.context,this.name=a.name||this.name,"undefined"!=typeof a.width&&0<a.width&&this.setWidth(a.width),"undefined"!=typeof a.height&&0<a.height&&this.setHeight(a.height),"undefined"!=typeof a.lineWidth&&0<a.lineWidth&&this.setLineWidth(a.lineWidth))},vars:{width:100,height:100,fill:"gray",event:{},shapeType:"rect"},
methods:{setWidth:function(a){this.width=a},setHeight:function(a){this.height=a},getWidth:function(){return this.width},getHeight:function(){return this.height},setFill:function(a){this.fill=a},getFill:function(){return fill},_clean:function(){var a=this.lineWidth;this.context.clearRect(this.x-0.5*a-1,this.y-0.5*a-1,this.width+1*a+2,this.height+1*a+2)},_draw:function(){this.context.beginPath();this.context.rect(this.x,this.y,this.width,this.height);this.context.fillStyle=this.fill;this.context.fill();
this.context.lineWidth=this.lineWidth;this.context.strokeStyle=this.stroke;this.context.stroke()}}});var CCircle=Class({base:CShape,construct:function(a){"undefined"!=typeof a&&(this.x=a.x||this.x,this.y=a.y||this.y,this.stroke=a.stroke||this.stroke,this.fill=a.fill||this.fill,this.context=a.context||this.context,this.name=a.name||this.name,"undefined"!=typeof a.radius&&0<a.radius&&(this.radius=a.radius),"undefined"!=typeof a.lineWidth&&0<a.lineWidth&&this.setLineWidth(a.lineWidth))},vars:{radius:100,fill:"gray",event:{},shapeType:"circle"},methods:{setRidius:function(a){this.radius=a},getRidius:function(){return this.radius},
setFill:function(a){this.fill=a},getFill:function(){return fill},_clean:function(){this.context.clearRect(this.x-this.radius-this.lineWidth,this.y-this.radius-this.lineWidth,this.x+this.radius+this.lineWidth,this.y+this.radius+this.lineWidth)},_draw:function(){this.context.beginPath();this.context.arc(this.x,this.y,this.radius,0,2*Math.PI,!1);this.context.closePath();this.context.fillStyle=this.fill;this.context.fill();this.context.lineWidth=this.lineWidth;this.context.strokeStyle=this.stroke;this.context.stroke()}}});CImage=Class({base:CShape,construct:function(a){"undefined"!=typeof a&&(this.x=a.x||this.x,this.y=a.y||this.y,this.angle=a.angle||this.angle,this.stroke=a.stroke||this.stroke,this.image=a.image||this.image,this.context=a.context||this.context,this.name=a.name||this.name,"undefined"!=typeof a.width&&0<a.width&&this.setWidth(a.width),"undefined"!=typeof a.height&&0<a.height&&this.setHeight(a.height),"undefined"!=typeof a.lineWidth&&0<a.lineWidth&&this.setLineWidth(a.lineWidth))},vars:{width:100,height:100,
angle:0,shapeType:"image"},methods:{setWidth:function(a){this.width=a},setHeight:function(a){this.height=a},getWidth:function(){return this.width},getHeight:function(){return this.height},setImage:function(a){this.image=a},getImage:function(){return this.image},_clean:function(){var a=this.lineWidth;this.context.clearRect(this.x-0.5*a-1,this.y-0.5*a-1,this.width+1*a+2,this.height+1*a+2)},_draw:function(){this.context.save();this.context.translate(this.x+this.image.width/2,this.y+this.image.height/
2);this.context.rotate(this.angle);this.context.translate(-(this.x+this.image.width/2),-(this.y+this.image.height/2));this.context.drawImage(this.image,this.x,this.y,this.width,this.height);this.context.restore()}}});var CStage=Class({construct:function(a){"undefined"!=typeof a.fps&&(this.fps=a.fps);"undefined"!=typeof a.width&&(this.width=a.width);"undefined"!=typeof a.height&&(this.height=a.height);if("undefined"!=typeof a.container){var a=document.getElementById(a.container),b=document.createElement("canvas");b.width=this.width;b.height=this.height;b.style.id="2k2nd";a.appendChild(b);this.context=b.getContext("2d")}else throw Error("The container is not found! Choose right name of container, please!");},vars:{collection:[],
context:{},fps:10,intervalId:null,width:500,height:500},methods:{add:function(a){if("object"==typeof a&&("shape"==a.type||"object"==a.type))a.setContext(this.context),this.collection.push(a);else throw Error("Stage: add() -> Incorrect object!");},remove:function(a){if("object"==typeof a&&("shape"==a.type||"object"==a.type))for(var b in this.collection)this.collection[b]==a&&delete this.collection[b]},_draw:function(a){for(var b in this.collection){var c=this.collection[b];"function"==typeof c._draw&&
c._draw.call(c,a)}},_update:function(a){for(var b in this.collection){var c=this.collection[b];"function"==typeof c._update&&c._update.call(c,a)}},_event:function(a){for(var b in this.collection){var c=this.collection[b];"function"==typeof c._event&&c._event.call(c,a)}},_begin:function(a){for(var b in this.collection)"function"==typeof this.collection[b]._begin&&this.collection[b]._begin.call(this.collection[b],a)},_clean:function(a){this.context.clearRect(0,0,a.width,a.height)},_process:function(){this._clean.call(this,
this);this._update.call(this,this);this._draw.call(this,this);this._event.call(this,this)},_onkeydown:function(a){console.log(this);for(var b in this.collection){var c=this.collection[b];console.log("erf");c._onkeydown.call(c,stage,a)}},run:function(){this._begin.call(this,this);var a=this;if(this.intervalId=setInterval(function(){a._process.call(a)},1E3/this.fps))console.log("Stage, run()");else throw Error("Stage, can't run!");},stop:function(){try{clearInterval(this.intervalId),console.log("Stage, stop()")}catch(a){console.log(a)}}}});
