function Class(a){var b=a.construct||function(){};if(a.base){var c=a.base,e=function(){};e.prototype=c.prototype;b.prototype=new e;b.prototype.constructor=b;for(var d in c)if("prototype"!=d){var e=c.__lookupGetter__(d),f=c.__lookupSetter__(d);e||f?(e&&b.__defineGetter__(d,e),f&&b.__defineSetter__(d,f)):b[d]=c[d]}e=function(){var a=this;if(1<arguments.length)throw Error("$base requires 0-1 parameters.");var b,d=a.$base;a.$base=c.__$base;if(1===arguments.length){var e=arguments[0];b=function(){if(c.prototype[e]){var b=
c.prototype[e].apply(a,arguments);a.$base=d;return b}throw Error("Method '"+e+"' not found.");}}else 0===arguments.length&&(b=function(){c.apply(a,arguments);a.$base=d});return b};b.__$base=e;b.prototype.$base=e}var g=a.methods||{};for(d in g)e=g.__lookupGetter__(d),f=g.__lookupSetter__(d),e||f?(e&&b.prototype.__defineGetter__(d,e),f&&b.prototype.__defineSetter__(d,f)):b.prototype[d]=g[d];e=a.vars||{};for(d in e)b.prototype["_"+d]=e[d];a=a.statics||{};for(d in a)b[d]=a[d];return b};var CSuperObj=Class({construct:function(){},vars:{context:null,x:0,y:0},methods:{set x(a){this._x=a},get x(){return this._x},set y(a){this._y=a},get y(){return this._y},set context(a){this._context=a},get context(){return this._context},clone:function(){var a=[],b=function(c){if(null==c||"object"!=typeof c)return c;for(var e in a)if(a[e]==c)return c;a.push(c);if("function"==typeof c.constructor){e=new c.constructor;for(var d in c)if(c.hasOwnProperty(d))if("context"==d)e[d]=c[d];else{var f=c.__lookupGetter__(d),
g=c.__lookupSetter__(d);f||g?(f&&e.prototype.__defineGetter__(d,f),g&&e.prototype.__defineSetter__(d,g)):e[d]=b(c[d])}}else return c;return e};return b(this)}}});var CObject=Class({base:CSuperObj,construct:function(a){if("undefined"!=typeof a){if("object"==typeof a.vars)for(var b in a.vars)this[b]=a.vars[b];"function"==typeof a.begin&&(this.__begin=a.begin);"function"==typeof a.update&&(this.__update=a.update);this.collection=[];if("object"==typeof a.collection&&a.collection instanceof Array&&1<=a.collection.length)for(var c in a.collection)("shape"==a.collection[c].type||"object"==a.collection[c].type)&&this.add(a.collection[c]);if("object"==typeof a.events)for(c in a.events)"function"==
typeof a.events[c]&&(this[c]=a.events[c])}},vars:{collection:[],type:"object"},methods:{add:function(a){if("object"==typeof a&&("shape"==a.type||"object"==a.type))a.context=this.context,this.collection.push(a);else throw Error("Object: add() -> Incorrect object!");},remove:function(a){try{if("object"==typeof a&&("shape"==a.type||"object"==a.type))for(var b in this.collection)this.collection[b]==a&&delete this.collection[b];else throw Error("Object: remove(O) -> O is not shape or object!");}catch(c){console.log(c)}},
set collection(a){try{if("object"==typeof a){this._collection=a;for(var b in a)if("shape"==a[b].type||"object"==a[b].type)this.add(a[b]);else throw Error("Object: set collection(O) -> O is not shape or object!");}else throw Error("Object: set collection(O) -> is not js'object!");}catch(c){console.log(c)}},get collection(){return this._collection},set context(a){this._context=a;for(var b in this.collection)this.collection[b].context=a},get context(){return this._context},set type(a){this._type=a},
get type(){return this._type},_draw:function(a){for(var b in this.collection)this.collection[b]._draw.call(this.collection[b],a)},_clean:function(a){for(var b in this.collection)this.collection[b]._clean.call(this.collection[b],a)},_update:function(a){"function"==typeof this.__update&&this.__update.call(this,a);for(var b in this.collection)"function"==typeof this.collection[b]._update&&this.collection[b]._update.call(this.collection[b],a)},_begin:function(a){"function"==typeof this.__begin&&this.__begin.call(this,
a);for(var b in this.collection)"function"==typeof this.collection[b]._begin&&this.collection[b]!=this&&this.collection[b]._begin.call(this.collection[b],a)},__intersection:function(a){var b=function(a,b){var c=a.x-a.lineWidth,d=a.x+a.width+a.lineWidth,e=a.y-a.lineWidth,f=a.y+a.height+a.lineWidth,g=b.x-b.lineWidth,i=b.x+b.width+b.lineWidth,h=b.y-b.lineWidth,k=b.y+b.height+b.lineWidth;if(g>=c&&i<=d||g>=c&&i>=d&&g<=d||g<=c&&i<=d&&i>=c||g<=c&&i>=d)if(h>=e&&k<=f||h>=e&&k>=f&&h<=f||h<=e&&k<=f&&k>=e||h<=
e&&k>=f)return!0;return!1},c=function(a,b){var c=a.y,d=a.radius,e=b.y,f=b.radius;return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(c-e,2))<=d+f?!0:!1},e=function(a,d){for(var f in a.collection){var g=a.collection[f],h;for(h in d.collection){var j=d.collection[h];if(g!=j)return"rect"==g.shapeType&&"rect"==j.shapeType&&!1==i?b(g,j)||!1:"circle"==g.shapeType&&"circle"==j.shapeType&&!1==i?c(g,j)||!1:"object"==g.type&&"object"==j.type&&!1==i?e(g,j)||!1:!1}}},d;for(d in this.collection){var f=this.collection[d],
g;for(g in this.collection){var h=this.collection[g];if(h!=f){var i=!1;"rect"==f.shapeType&&("rect"==h.shapeType&&!1==i)&&(i=b(f,h)||!1);"circle"==f.shapeType&&("circle"==h.shapeType&&!1==i)&&(i=c(f,h)||!1);"object"==f.type&&("object"==h.type&&!1==i)&&(i=e(f,h)||!1);i&&"function"==typeof this.intersection&&this.intersection.call(this,f,h,a)}}}},__mouse_move:function(){},_event:function(a){this.__intersection.call(this,a);this.__mouse_move.call(this,a);for(var b in this.collection)"function"==typeof this.collection[b]._event&&
this.collection[b]._event.call(this.collection[b],a)},_onkeydown:function(a,b){"function"==typeof this.onkeydown&&this.onkeydown.call(e,a,b);for(var c in this.collection){var e=this.collection[c];"function"==typeof e._onkeydown&&e._onkeydown.call(e,a,b)}}}});CShape=Class({base:CSuperObj,construct:function(){},vars:{parent:"no",stroke:"black",lineWidth:1,angel:0,type:"shape"},methods:{set stroke(a){this._stroke=a},get stroke(){return this._stroke},set lineWidth(a){this._lineWidth=a},get lineWidth(){return this._lineWidth},set parent(a){this._parent=a},get parent(){return this._parent},set type(a){this._type=a},get type(){return this._type},set angel(a){this._angel=a*Math.PI/180},get angel(){return 180*this._angel/Math.PI}}});var CRect=Class({base:CShape,construct:function(a){"undefined"!=typeof a&&(this.x=a.x||this.x,this.y=a.y||this.y,this.angel=a.angel||this.angel,this.stroke=a.stroke||this.stroke,this.fill=a.fill||this.fill,this.context=a.context||this.context,this.name=a.name||this.name,"undefined"!=typeof a.width&&0<a.width&&(this.width=a.width),"undefined"!=typeof a.height&&0<a.height&&(this.height=a.height),"undefined"!=typeof a.lineWidth&&0<a.lineWidth&&(this.lineWidth=a.lineWidth))},vars:{width:100,height:100,
fill:"gray",shapeType:"rect"},methods:{set width(a){this._width=a},get width(){return this._width},set height(a){this._height=a},get height(){return this._height},set fill(a){this._fill=a},get fill(){return this._fill},_clean:function(){},_draw:function(){this.context.save();this.context.translate(this.x+this.width/2,this.y+this.height/2);this.context.rotate(this.angel*Math.PI/180);this.context.translate(-(this.x+this.width/2),-(this.y+this.height/2));this.context.beginPath();this.context.rect(this.x,
this.y,this.width,this.height);this.context.closePath();this.context.fillStyle=this.fill;this.context.lineWidth=this.lineWidth;this.context.strokeStyle=this.stroke;this.context.fill();this.context.stroke();this.context.restore()}}});var CCircle=Class({base:CShape,construct:function(a){"undefined"!=typeof a&&("number"==typeof a.x&&(this.x=a.x),"number"==typeof a.y&&(this.y=a.y),"number"==typeof a.stroke&&(this.x=a.stroke),"number"==typeof a.fill&&(this.fill=a.fill),"undefined"!=typeof a.name&&(this.name=a.name),"undefined"!=typeof a.context&&(this.x=a.stroke),"undefined"!=typeof a.radius&&0<a.radius&&(this.radius=a.radius),"undefined"!=typeof a.lineWidth&&0<a.lineWidth&&(this.lineWidth=a.lineWidth))},vars:{radius:100,fill:"gray",
shapeType:"circle"},methods:{set radius(a){this._radius=a},get radius(){return this._radius},set fill(a){this._fill=a},get fill(){return this._fill},_clean:function(){this.context.clearRect(this.x-this.radius-this.lineWidth,this.y-this.radius-this.lineWidth,this.x+this.radius+this.lineWidth,this.y+this.radius+this.lineWidth)},_draw:function(){this.context.beginPath();this.context.arc(this.x,this.y,this.radius,0,2*Math.PI,!1);this.context.closePath();this.context.fillStyle=this.fill;this.context.fill();
this.context.lineWidth=this.lineWidth;this.context.strokeStyle=this.stroke;this.context.stroke()}}});CImage=Class({base:CShape,construct:function(a){"undefined"!=typeof a&&(this.x=a.x||this.x,this.y=a.y||this.y,this.angel=a.angel||this.angel,this.angle=a.angle||this.angle,this.stroke=a.stroke||this.stroke,this.image=a.image||this.image,this.context=a.context||this.context,this.name=a.name||this.name,"undefined"!=typeof a.width&&0<a.width&&(this.width=a.width),"undefined"!=typeof a.height&&0<a.height&&(this.height=a.height),"undefined"!=typeof a.lineWidth&&0<a.lineWidth&&(this.lineWidth=a.lineWidth))},
vars:{width:100,height:100,shapeType:"image"},methods:{set width(a){this._width=a},set height(a){this._height=a},get width(){return this._width},get height(){return this._height},set image(a){this._image=a},get image(){return this._image},_clean:function(){},_draw:function(){this.context.save();this.context.translate(this.x+this.width/2,this.y+this.height/2);this.context.rotate(this.angel*Math.PI/180);this.context.translate(-(this.x+this.width/2),-(this.y+this.height/2));this.context.drawImage(this.image,
this.x,this.y,this.width,this.height);this.context.restore()}}});var CStage=Class({construct:function(a){"undefined"!=typeof a.fps&&(this.fps=a.fps);"undefined"!=typeof a.width&&(this.width=a.width);"undefined"!=typeof a.height&&(this.height=a.height);if("undefined"!=typeof a.container){var a=document.getElementById(a.container),b=document.createElement("canvas");b.width=this.width;b.height=this.height;b.style.id="2k2nd";a.appendChild(b);this.context=b.getContext("2d")}else throw Error("The container is not found! Choose right name of container, please!");},vars:{collection:[],
context:{},fps:10,intervalId:null,width:500,height:500},methods:{add:function(a){if("object"==typeof a&&("shape"==a.type||"object"==a.type))a.context=this.context,this.collection.push(a);else throw Error("Stage: add(O) -> O is not shape or object!");},remove:function(a){if("object"==typeof a&&("shape"==a.type||"object"==a.type))for(var b in this.collection)this.collection[b]==a&&delete this.collection[b];else throw Error("Stage: remove(O) -> O is not shape or object!");},_draw:function(a){for(var b in this.collection){var c=
this.collection[b];"function"==typeof c._draw&&c._draw.call(c,a)}},_update:function(a){for(var b in this.collection){var c=this.collection[b];"function"==typeof c._update&&c._update.call(c,a)}},_event:function(a){for(var b in this.collection){var c=this.collection[b];"function"==typeof c._event&&c._event.call(c,a)}},_begin:function(a){for(var b in this.collection)"function"==typeof this.collection[b]._begin&&this.collection[b]._begin.call(this.collection[b],a)},_clean:function(a){this.context.clearRect(0,
0,a.width,a.height)},_process:function(){this._clean.call(this,this);this._update.call(this,this);this._draw.call(this,this);this._event.call(this,this)},run:function(){this._begin.call(this,this);var a=this;if(this.intervalId=setInterval(function(){a._process.call(a)},1E3/this.fps))console.log("Stage, run()");else throw Error("Stage, can't run!");},stop:function(){try{clearInterval(this.intervalId),console.log("Stage, stop()")}catch(a){console.log(a)}},set collection(a){this._collection=a},get collection(){return this._collection}}});
