(function(){var b=function(){};b.prototype={types:"String Number Array Function Date Object RegExp Bool".split(" "),About:{},Modules:{},Plugins:{}};window.gizmo=new b})();
(function(b){b.isSet=function(b){return void 0!=b&&null!=b?!0:!1};b.itIs=function(d,c){if(b.isSet(d)){var a=Object.prototype.toString.call(d).slice(8,-1);return null!==d&&a==c}return!1};b.type=function(b){return{}.toString.call(b).slice(8,-1)};b.clone=function c(a){if("Array"!==b.type(a)&&"Object"!==b.type(a))return a;var f=new a.constructor;for(i in a)a[i]&&a.hasOwnProperty(i)&&(f[i]=b.itIs(a[i],"Object")?c(a[i]):a[i]&&b.itIs(a[i],"Array")?[].concat(a[i]):a[i]);return f};b.Modules.baseVariableFunction=
{name:"Type",version:0.1,author:"Alexander Lizin aka Sogimu",email:"sogimu@nxt.ru",description:"\u041c\u043e\u0434\u0443\u043b\u044c \u0434\u043b\u044f \u0432\u0432\u0435\u0434\u0435\u043d\u0438\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043e\u043a \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u044b\u0445 \u043d\u0430 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0435, \u0443\u0442\u0438\u043d\u043d\u043e\u0439 \u0442\u0438\u043f\u0438\u0437\u0430\u0446\u0438\u0438 \u0438 \u0442.\u0434. "}})(gizmo);
(function(b){b.Filter=function(d,c){var a;if(a=b.isSet(d))if(a=!0===b.itIs(d,c))if(!0===b.itIs(c,"String")){a=!0;for(var f in b._types)if(c===b._types[f]){a=!1;break}}else throw TypeError(b.type(c)+" <- it's not name of type");if(a)return d;throw TypeError(b.type(d)+" != "+c);};b.Modules.Filters={name:"Filters",version:0.1,author:"Alexander Lizin aka Sogimu",email:"sogimu@nxt.ru",description:'\u041c\u043e\u0434\u0443\u043b\u044c \u0434\u043b\u044f \u0432\u0432\u0435\u0434\u0435\u043d\u0438\u044f "\u0444\u0438\u043b\u044c\u0442\u0440\u0430" \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u044e\u0449\u0438\u0445 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \u043f\u0435\u0440\u0435\u0434\u0430\u043d\u043d\u043e\u0439 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u0435\u0451 \u0442\u0438\u043f\u0443'}})(gizmo);
(function(b){b.isTString=function(d){return b.itIs(d,"String")};b.isTNumber=function(d){return b.itIs(d,"Number")};b.isTBool=function(d){return b.itIs(d,"Boolean")};b.isTArray=function(d){return b.itIs(d,"Array")};b.isTFunc=function(d){return b.itIs(d,"Function")};b.isTDate=function(d){return b.itIs(d,"Date")};b.isTRegExp=function(d){return b.itIs(d,"RegExp")};b.isTObject=function(d){return b.itIs(d,"Object")};b.Modules.Checks={name:"Checks",version:0.1,author:"Alexander Lizin aka Sogimu",email:"sogimu@nxt.ru",
description:"\u041c\u043e\u0434\u0443\u043b\u044c \u0434\u043b\u044f \u0432\u0432\u0435\u0434\u0435\u043d\u0438\u044f \u043c\u0435\u0442\u043e\u0434\u043e\u0432 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0442\u0438\u043f\u0430, \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0442\u0438\u043f\u0430"}})(gizmo);
(function(b){b.Class=function(d,c){var a=d.Initialize||function(){};if(d.Extend){var f=d.Extend,e=function(c){var e=f.prototype,h;for(h in e)switch(b.type(e[h])){case "Array":this[h]=[].concat(e[h]);break;case "Object":this[h]=b.clone(e[h])}var e=d.Statics||{},g;for(g in e)switch(b.type(e[g])){case "Array":this[g]=[].concat(e[g]);break;case "Object":this[g]=b.clone(e[g])}g=d.Methods||{};for(var k in g)e=g.__lookupGetter__(k),h=g.__lookupSetter__(k),e||h?(e&&this.__defineGetter__(k,e),h&&this.__defineSetter__(k,
h)):this[k]=g[k];a.call(this,c||{})},h=function(){};h.prototype=f.prototype;e.prototype=new h;e.prototype.constructor=e;for(var g in f)if("prototype"!=g){var h=f.__lookupGetter__(g),k=f.__lookupSetter__(g);h||k?(h&&e.__defineGetter__(g,h),k&&e.__defineSetter__(g,k)):e[g]=f[g]}}else e=function(c){var f=d.Statics||{},e;for(e in f)switch(b.type(f[e])){case "Array":this[e]=[].concat(f[e]);break;case "Object":this[e]=b.clone(f[e])}var f=d.Methods||{},h;for(h in f){e=f.__lookupGetter__(h);var g=f.__lookupSetter__(h);
e||g?(e&&this.__defineGetter__(h,e),g&&this.__defineSetter__(h,g)):this[h]=f[h]}a.call(this,c||{})};var l=d.Methods||{};for(g in l)h=l.__lookupGetter__(g),k=l.__lookupSetter__(g),h||k?(h&&e.prototype.__defineGetter__(g,h),k&&e.prototype.__defineSetter__(g,k)):e.prototype[g]=l[g];var m=d.Statics||{};if(b.isSet(c)&&b.isSet(c.checkingMode)&&c.checkingMode)for(g in m)e.prototype["_"+g]=m[g],h=function(){var a="_"+g,c=m[g];return function(){return b.Filter(this[a],b.type(c))}}(g),k=function(){var a="_"+
g,c=m[g];return function(f){this[a]=b.Filter(f,b.type(c))}}(g),e.prototype.__defineGetter__(g,h),e.prototype.__defineSetter__(g,k);else for(g in m)switch(b.type(m[g])){case "Array":e.prototype[g]=[].concat(m[g]);break;case "Object":e.prototype[g]=b.clone(m[g]);break;default:e.prototype[g]=m[g]}return e};b.Modules.Class={name:"Class",version:0.1,author:"Alexander Lizin aka Sogimu",email:"sogimu@nxt.ru",description:"\u041c\u043e\u0434\u0443\u043b\u044c \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0439 \u043a\u043b\u0430\u0441\u0441\u044b"}})(gizmo);
(function(b){b.nativeSort=function(b){var c=b.mas?b.mas:[],a=b.target?b.target:">";b.field?">"==a?c.sort(function(a,c){var h=a[b.field],g=c[b.field];return h>g?-1:h<g?1:0}):c.sort(function(a,c){var h=a[b.field],g=c[b.field];return h<g?-1:h>g?1:0}):">"==a?c.sort(function(a,c){return a>c?-1:a<c?1:0}):c.sort(function(a,c){return a<c?-1:a>c?1:0});return c};b.Modules.Sorts={name:"Sorts",version:0.1,author:"Alexander Lizin aka Sogimu",email:"sogimu@nxt.ru",description:"\u041c\u043e\u0434\u0443\u043b\u044c \u0434\u043b\u044f \u0432\u0432\u0435\u0434\u0435\u043d\u0438\u044f \u043c\u0435\u0442\u043e\u0434\u043e\u0432 \u0440\u0435\u0430\u043b\u0438\u0437\u0443\u044e\u0449\u0438\u0445 \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0438"}})(gizmo);
(function(b){b.Math={};b.Math.Sgn=function(b){return 0<b?1:0>b?-1:0};b.Modules.Math={name:"Math",version:0.1,author:"Alexander Lizin aka Sogimu",email:"sogimu@nxt.ru",description:"\u041c\u043e\u0434\u0443\u043b\u044c \u0441 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u043c\u0438 \u0444\u0443\u043d\u043a\u0446\u0438\u044f\u043c\u0438"}})(gizmo);
(function(b){var d=b.Class({Initialize:function(c){return this.setElements(c)},Statics:{},Methods:{create:function(c){return new b.Math.Matrix(c)},canMultiplyFromLeft:function(c){if(0===this.elements.length)return!1;c=c.elements||c;"undefined"===typeof c[0][0]&&(c=this.Matrix.create(c).elements);return this.elements[0].length===c.length},map:function(c){var a=[],f=this.elements.length,e=f,b,d,k=this.elements[0].length,l;do{b=e-f;d=k;a[b]=[];do l=k-d,a[b][l]=c(this.elements[b][l],b+1,l+1);while(--d)}while(--f);
return this.create(a)},multiply:function(c){if(0===this.elements.length)return null;if(!c.elements)return this.map(function(a){return a*c});var a=c.modulus?!0:!1,f=c.elements||c;"undefined"===typeof f[0][0]&&(f=this.create(f).elements);if(!this.canMultiplyFromLeft(f))return null;for(var e=this.elements.length,b=f[0].length,d,k=this.elements[0].length,l,m=[],n;e--;){d=b;for(m[e]=[];d--;){l=k;for(n=0;l--;)n+=this.elements[e][l]*f[l][d];m[e][d]=n}}f=this.create(m);return a?f.col(1):f},x:function(c){return this.multiply(c)},
setElements:function(c){var a,f=c.elements||c;if(f[0]&&"undefined"!==typeof f[0][0]){c=f.length;for(this.elements=[];c--;){a=f[c].length;for(this.elements[c]=[];a--;)this.elements[c][a]=f[c][a]}return this}a=f.length;this.elements=[];for(c=0;c<a;c++)this.elements.push([f[c]]);return this},isSquare:function(){return this.elements.length==this.elements[0].length},toRightTriangular:function(){var c=this.dup(),a,f=this.elements.length,e=f,b,d,k=this.elements[0].length,l;do{b=e-f;if(0==c.elements[b][b])for(j=
b+1;j<e;j++)if(0!=c.elements[j][b]){a=[];d=k;do l=k-d,a.push(c.elements[b][l]+c.elements[j][l]);while(--d);c.elements[b]=a;break}if(0!=c.elements[b][b])for(j=b+1;j<e;j++){var m=c.elements[j][b]/c.elements[b][b];a=[];d=k;do l=k-d,a.push(l<=b?0:c.elements[j][l]-c.elements[b][l]*m);while(--d);c.elements[j]=a}}while(--f);return c},determinant:function(){if(!this.isSquare())return null;var c=this.toRightTriangular(),a=c.elements[0][0],b=c.elements.length-1,e=b,d;do d=e-b+1,a*=c.elements[d][d];while(--b);
return a},det:function(){return this.determinant()},dup:function(){return this.create(this.elements)},transpose:function(){var c=this.elements.length,a=this.elements[0].length,b=[],e=a,d,g,k;do{d=a-e;b[d]=[];g=c;do k=c-g,b[d][k]=this.elements[k][d];while(--g)}while(--e);return this.create(b)}}});b.Math.Matrix=d;b.Modules.Matrix={name:"Matrix",version:0.1,author:"Alexander Lizin aka Sogimu",email:"sogimu@nxt.ru",description:"\u041c\u043e\u0434\u0443\u043b\u044c \u0434\u043b\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u0441 \u043c\u0430\u0442\u0440\u0438\u0446\u0430\u043c\u0438. \u0421\u043e\u0437\u0434\u0430\u043d \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438 http://sylvester.jcoglan.com."}})(gizmo);
(function(b){var d=function(c,a){this._x=c;this._y=a};d.prototype={_x:0,_y:0,Minus:function(c){return new b.Math.Point2D(this.x-c.x,this.y-c.y)},set x(c){this._x=c},get x(){return this._x},set y(c){this._y=c},get y(){return this._y}};b.Math.Point2D=d;b.Modules.Point2D={name:"Point2D",version:0.1,author:"Alexander Lizin aka Sogimu",email:"sogimu@nxt.ru",description:"2D-\u0442\u043e\u0447\u043a\u0430"}})(gizmo);
(function(b){var d=function(c,a){this._x=c;this._y=a};d.prototype={_x:0,_y:0,X:function(c){return this.x*c.x+this.y*c.y},Module:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Angle:function(c){var a=(new b.Math.Matrix([[this.x,this.y],[c.x,c.y]])).determinant();return 0==this.Module()*c.Module()?0:0!=a?b.Math.Sgn(a)*Math.acos(c.X(this)/(this.Module()*c.Module())):Math.acos(c.X(this)/(this.Module()*c.Module()))},set x(c){this._x=c},get x(){return this._x},set y(c){this._y=c},get y(){return this._y}};
b.Math.Vector2D=d;b.Modules.Vector2D={name:"Vector2D",version:0.1,author:"Alexander Lizin aka Sogimu",email:"sogimu@nxt.ru",description:"2D-\u0432\u0435\u043a\u0442\u043e\u0440"}})(gizmo);
(function(b){var d=b.Class({Initialize:function(c){if(b.isTArray(c))for(var a in c)this.AddPoint(c[a]);else throw Error("Argument are not array!");},Statics:{_points:[]},Methods:{AddPoint:function(c){this._points.push(c);return this},HasPoint:function(c){var a=[],f=this._points,e;for(e in f)a.push(new b.Math.Vector2D(f[e].x-c.x,f[e].y-c.y));for(e=c=0;e<a.length-1;e++)c+=a[e].Angle(a[e+1]);c+=a[a.length-1].Angle(a[0]);return 0.01>c-2*Math.PI&&-0.01<c-2*Math.PI?!0:!1},GetPointByIndex:function(c){if(b.isTNumber(c)&&
0<=c)return this._points[c];throw Error("index must be poistive integer!");}}});b.Math.Polygone=d;b.Modules.polygone={name:"polygone",version:0.1,author:"Alexander Lizin aka Sogimu",email:"sogimu@nxt.ru",description:"\u041f\u043e\u043b\u0438\u0433\u043e\u043d \u0437\u0430\u0434\u0430\u043d\u043d\u044b\u0439 \u0432\u0435\u043a\u0442\u043e\u0440\u0430\u043c\u0438"}})(gizmo);
(function(b){var d=b.Class({construct:function(c){this.action=c.action;this.formId=c.id;this.onSubmit=c.onSubmit;this.onComplete=c.onComplete;this.createIframe();this.createForm()},vars:{formId:"",form:{},iframe:{},onSubmit:function(){},onComplete:function(){}},methods:{createForm:function(){var c=document.getElementById(this.formId);c.action=this.action;c.target=this.iframeName;c.enctype="multipart/form-data";c.method="POST";this.form=c},createIframe:function(){this.iframeName="rFrame";var c=document.createElement("iframe");
c.name="rFrame";c.style.display="none";document.getElementsByTagName("body")[0].appendChild(c);this.iframe=c},send:function(){return!1!==this.onSubmit()?(this.form.submit(),!0):!1}}});b.Plugins.iframeAJAX={name:"iframeAJAX",version:0.1,author:"Alexander Lizin aka Sogimu",email:"sogimu@nxt.ru",description:"\u041f\u043b\u0430\u0433\u0438\u043d \u0434\u043b\u044f AJAX \u043d\u0430 iframe"};b.iframeAjax=d})(gizmo);(function(b){b=b.Class({Initialize:function(){return this},Statics:{_type:["ArmLib","ArmLib"],_name:"ArmLib",_list:[],_class:{},_armlib:this,_lib:b},Methods:{bindWithTag:function(b){function c(){try{var a=document.createElement("div");a.id="ArmLibContainer";document.body.appendChild(a);this._container=a}catch(c){throw Error("Error with creating container!");}}if(b.container){var a=document.getElementById("container");if(a)this._container=a;else throw Error("have't use tag with id = "+b.container+
"!");}else c()},run:function(){this.ListenMouseKeyboardEvents();for(var b in this._list)this._list[b].run();return this},stop:function(){this.NotListenMouseKeyboardEvents();for(var b in this._list)this._list[b].stop();return this},_addLayer:function(b){b._setOwner(this);this._list.push(b);return this},_removeLayer:function(){},_listenKeybordEvents:function(){var b=this;window.onkeydown=function(c){b.__onKeyDown(c)};window.onkeypress=function(c){b.__onKeyPress(c)};window.onkeyup=function(c){b.__onKeyUp(c)}},
_notListenKeybordEvents:function(){window.onkeydown=null;window.onkeypress=null;window.onkeyup=null},_listenMouseEvents:function(){var b=this;this.container.onmousedown=function(c){b.__onMouseDown(c)};this.container.onmouseup=function(c){b.__onMouseUp(c)};this.container.onmousemove=function(c){b.__onMouseMove(c)}},_notListenMouseEvents:function(){this.container.onmousedown=null;this.container.onmouseup=null;this.container.onmousemove=null},ListenMouseKeyboardEvents:function(){this._listenKeybordEvents();
this._listenMouseEvents()},NotListenMouseKeyboardEvents:function(){this._notListenKeybordEvents();this._notListenMouseEvents()},_sendEvent:function(b){for(var c in this._list)this._list[c].getRunStatus()&&this._list[c]._eventStack.push(b)},__onKeyDown:function(b){this._sendEvent({name:"onKeyDown",type:"keyboard",e:b})},__onKeyPress:function(b){this._sendEvent({name:"onKeyPress",type:"keyboard",e:b})},__onKeyUp:function(b){this._sendEvent({name:"onKeyUp",type:"keyboard",e:b})},__onMouseDown:function(b){this._sendEvent({name:"onMouseDown",
type:"mouse",e:b})},__onMouseUp:function(b){this._sendEvent({name:"onMouseUp",type:"mouse",e:b})},__onMouseMove:function(b){this._sendEvent({name:"onMouseMove",type:"mouse",e:b})},set container(b){this._container=b},get container(){return this._container}}});window.armlib=new b})(window.gizmo);(function(b,d){var c=d.Class({Initialize:function(){},Statics:{_type:["","","ArmObject"],_name:"ArmObj "+100*Math.random(),_isLoaded:!1,_owner:null,_armlib:b,_lib:d},Methods:{Load:function(){this._load();return this},_begin:function(){console.log("virtual function")},_update:function(){console.log("virtual function")},_load:function(){console.log("virtual function")},__onLoad:function(){this._setLoaded();this._onLoad&&this._onLoad.call(this,this._layer,b,d);this.haveOwner()&&this.owner._loadedChild()},
setFunc:function(a,b){a&&b&&(this["_"+a]=b);return this},getFunc:function(){if(name&&func)return this["_"+name]},haveOwner:function(){return this._owner?!0:!1},_setType:function(a){this._type=a},_setName:function(a){this._name=a},_setLoaded:function(){this._isLoaded=!0},_setUnloaded:function(){this._loaded=!1},_setOwner:function(a){this._owner=a},get isLoaded(){return this._isLoaded},get name(){return this._name},get owner(){return this._owner},get type(){return this._type}}});b._class.ArmObj=c})(armlib,
gizmo);(function(b){var d=b.Class({Initialize:function(c){if(b.isTArray(c))for(var a in c)this.AddPoint(c[a]);else throw Error("Argument are not array!");},Statics:{_unchangedPoints:[],_translatedPoints:[],_transformedPoints:[],_matrixOfTranslatePoints:{},_matrixOfTransformedPoints:{},_polygoneOfTransformedPoints:{}},Methods:{AddPoint:function(c){this._unchangedPoints.push(new b.Math.Point2D(c.x,c.y));this._translatedPoints.push(new b.Math.Point2D(c.x,c.y));this._transformedPoints.push(new b.Math.Point2D(c.x,
c.y));this._updateMatrixOfUnchangedPoints();return this},HasPoint:function(b){return this._polygoneOfTransformedPoints.HasPoint(b)},Translate:function(c,a){arrMatrix=[];var f=this._unchangedPoints,e;for(e in f){var d=f[e].y;this._translatedPoints[e].x=f[e].x+c;this._translatedPoints[e].y=d+a}f=this._translatedPoints;for(e in f)arrMatrix.push([f[e].x,f[e].y,1]);this._matrixOfTranslatePoints=new b.Math.Matrix(arrMatrix)},Transform:function(b){var b=this._matrixOfTranslatePoints.x(b),a=b.elements,f;
for(f in a)this._transformedPoints[f].x=a[f][0],this._transformedPoints[f].y=a[f][1];this._updatePolygoneOfTransformedPoints();return b},Show:function(b){var a=this._polygoneOfTransformedPoints._points,f=b._context;f.strokeStyle="#000000";f.clearRect(0,0,b.width,b.height);f.beginPath();f.moveTo(a[0].x,a[0].y);for(var e in a)f.lineTo(a[1*e].x,a[1*e].y);f.lineTo(a[0].x,a[0].y);f.closePath();f.stroke()},_updateMatrixOfUnchangedPoints:function(){arrMatrix=[];var c=this._unchangedPoints,a;for(a in c)arrMatrix.push([c[a].x,
c[a].y,1]);this._matrixOfUnchangedPoints=new b.Math.Matrix(arrMatrix)},_updatePolygoneOfTransformedPoints:function(){arrVectors=[];var c=this._transformedPoints,a;for(a in c)arrVectors.push(new b.Math.Vector2D(c[a].x,c[a].y));this._polygoneOfTransformedPoints=new b.Math.Polygone(arrVectors)}}});armlib._class.Skeleton=d})(gizmo);(function(b,d){var c=d.Class({Extend:b._class.ArmObj,Initialize:function(){},Statics:{_type:["ArmObject","VisualObj"],_context:null,_layer:null,_x:0,_y:0,_angle:0,_centralPoint:{x:1,y:1},_scale:{x:1,y:1},_zindex:0,_globalAlpha:1,__transformMatrix:[],_paramsTransformMatrix:[],_skeleton:{},_haveChanges:!0,_changes:{x:0,y:0,width:0,height:0,angle:0,scale:{x:1,y:1},centralPoint:{x:0,y:0}},_armlib:b,_lib:d},Methods:{haveLayer:function(){return this._layer?!0:!1},haveChanges:function(){return this._haveChanges},
setHaveNotChanges:function(){this._changes={x:0,y:0,width:0,height:0,angle:0,scale:{x:0,y:0},centralPoint:{x:0,y:0},zindex:0,globalAlpha:1};this._haveChanges=!1},setHaveChanges:function(){this._haveChanges=!0},_clear:function(){console.log("virtual function")},_begin:function(){console.log("virtual function")},_draw:function(){console.log("virtual function")},initTransformMatrix:function(){var a=this.angle,b=this.centralPoint.x,c=this.centralPoint.y,d=Math.cos(a),a=Math.sin(a),g,k;this._transformMatrix=
new gizmo.Math.Matrix([[d,-a,-c*a-b*(d-1)],[a,d,-c*(d-1)+b*a],[0,0,1]]);d=this._transformMatrix.elements[0][0];a=this._transformMatrix.elements[1][0];b=this._transformMatrix.elements[0][1];c=this._transformMatrix.elements[1][1];k=this._transformMatrix.elements[0][2];g=this._transformMatrix.elements[1][2];this._paramsTransformMatrix={a:d,b:a,c:b,d:c,e:k,f:g}},updateTransformMatrix:function(){var a=this.angle,b=this.centralPoint.x,c=this.centralPoint.y,d=Math.cos(a),a=Math.sin(a),g,k;this._transformMatrix=
new gizmo.Math.Matrix([[d,-a,-c*-a-b*(d-1)],[a,d,-c*(d-1)+b*-a],[0,0,1]]);d=this._transformMatrix.elements[0][0];a=this._transformMatrix.elements[1][0];b=this._transformMatrix.elements[0][1];c=this._transformMatrix.elements[1][1];k=this._transformMatrix.elements[0][2];g=this._transformMatrix.elements[1][2];this._paramsTransformMatrix={a:d,b:a,c:b,d:c,e:k,f:g}},initSkeleton:function(a){var c=new b._class.Skeleton([]);if(a)for(var e in a)c.AddPoint(new gizmo.Math.Point2D(a[e].x,a[e].y));else c.AddPoint(new gizmo.Math.Point2D(this.x-
this.x,this.y-this.y)),c.AddPoint(new gizmo.Math.Point2D(this.x+this.width-this.x,this.y-this.y)),c.AddPoint(new gizmo.Math.Point2D(this.x+this.width-this.x,this.y+this.height-this.y)),c.AddPoint(new gizmo.Math.Point2D(this.x-this.x,this.y+this.height-this.y));this.Skeleton=c;this.Skeleton.Translate(0,0)},updateSkeleton:function(){this.Skeleton.Translate(this.x,this.y);this.Skeleton.Transform(this.TransformMatrix.transpose())},_setContext:function(a){this._context=a},_setLayer:function(a){this._layer=
a},set x(a){this._changes.x=a-this._x;this._x=a;this._haveChanges=!0},get x(){return this._x},set y(a){this._changes.y=a-this._y;this._y=a;this._haveChanges=!0},get y(){return this._y},set width(a){this._changes.width=a-this._width;this._width=a;this._haveChanges=!0},get width(){return this._width},set height(a){this._changes.height=a-this._height;this._height=a;this._haveChanges=!0},get height(){return this._height},set angle(a){a>2*Math.PI?(this._changes.angle=a-this._angle,this._angle=a%Math.PI):
(this._changes.angle=a-this._angle,this._angle=a);this._haveChanges=!0},get angle(){return this._angle},set centralPoint(a){this._changes.centralPoint.x=a.x-this.centralPoint.x;this._changes.centralPoint.y=a.y-this.centralPoint.y;this._centralPoint=a;this._haveChanges=!0},get centralPoint(){return this._centralPoint},set scale(a){this._changes.scale.x=a.x-this._scale.x;this._changes.scale.y=a.y-this._scale.y;this._scale=a;this._haveChanges=!0},get scale(){return this._scale},set zindex(a){this._changes.zindex=
a-this._zindex;this._zindex=a;this.haveOwner()&&this.owner._sortByZindex();this._haveChanges=!0},get zindex(){return this._zindex},set globalAlpha(a){0<=a&&1>=a?(this._changes.globalAlpha=a-this._globalAlpha,this._globalAlpha=a):0>a?(this._changes.globalAlpha=0-this._globalAlpha,this._globalAlpha=0):1<a&&(this._changes.globalAlpha=1-this._globalAlpha,this._globalAlpha=1);this._haveChanges=!0},get globalAlpha(){return this._globalAlpha},get context(){return this._context},get layer(){return this._layer},
get TransformMatrix(){return this._transformMatrix},set _transformMatrix(a){this.__transformMatrix=a},get _transformMatrix(){return this.__transformMatrix},get ParamsTransformMatrix(){return this._paramsTransformMatrix}}});b._class.VisualObj=c})(armlib,gizmo);(function(b,d){var c=d.Class({Extend:b._class.VisualObj,Statics:{_type:["Primitive",""],_fill:"#00FF00",_stroke:"#00aa00",_drawRect:{drawingRectPos:{p0:{x:0,y:0},p1:{x:0,y:0}},drawingRectImage:new Image}},Methods:{saveDrawingRectImage:function(){var a=this._drawRect.drawingRectPos;this._drawRect.drawingRectImage=this._context.getImageData(a.p0.x,a.p0.y,a.p1.x,a.p1.y)},removeDrawingRectImage:function(){var a=this._drawRect.drawingRectPos;this._context.putImageData(this._drawRect.drawingRectImage,a.p0.x,
a.p0.y)},updateDrawingRectPos:function(){var a=this.TransformMatrix,b=new gizmo.Math.Matrix([[this.x,this.x+this.width,this.x+this.width,this.x],[this.y,this.y,this.y+this.height,this.y+this.height],[1,1,1,1]]),c=a.x(b).elements,a=Math.floor(Math.min(c[0][0],c[0][1],c[0][2],c[0][3])),b=Math.floor(Math.min(c[1][0],c[1][1],c[1][2],c[1][3])),d=Math.ceil(Math.max(c[0][0],c[0][1],c[0][2],c[0][3])-a),c=Math.ceil(Math.max(c[1][0],c[1][1],c[1][2],c[1][3])-b);this._drawRect.drawingRectPos={p0:{x:a,y:b},p1:{x:d,
y:c}}},ShowSaveingRect:function(a){var b=this._drawRect.drawingRectPos,a=a._context;a.beginPath();a.strokeStyle="#FF0000";a.rect(b.p0.x,b.p0.y,b.p1.x,b.p1.y);a.rect(this.centralPoint.x-2,this.centralPoint.y-2,4,4);a.closePath();a.stroke()},ShowRemovingRect:function(a){var b=this._drawRect.drawingRectPos,a=a._context;a.beginPath();a.strokeStyle="#0000FF";a.rect(b.p0.x,b.p0.y,b.p1.x,b.p1.y);a.closePath();a.stroke()},_begin:function(){this.setHaveChanges();this._onBegin&&this._onBegin.call(this,this._layer,
b,d);this.initTransformMatrix();this.initSkeleton();this.updateDrawingRectPos();this.saveDrawingRectImage()},_clear:function(){this.removeDrawingRectImage()},_update:function(){this._onUpdate&&this._onUpdate.call(this,this._layer,b,d);this.haveChanges()&&(this.updateTransformMatrix(),this.updateSkeleton(),this.updateDrawingRectPos(),this.saveDrawingRectImage())},_draw:function(){console.log("virtual function")},__onKeyDown:function(a){this._onKeyDown&&this._onKeyDown(a)},__onKeyPress:function(a){this._onKeyPress&&
this._onKeyPress(a)},__onKeyUp:function(a){this._onKeyUp&&this._onKeyUp(a)},__onMouseDown:function(a){this._onMouseDown&&this.Skeleton.HasPoint({x:a.x,y:a.y})&&this._onMouseDown(a)},__onMouseUp:function(a){this._onMouseUp&&this.Skeleton.HasPoint({x:a.x,y:a.y})&&this._onMouseUp(a)},__onMouseMove:function(a){this._onMouseMove&&this.Skeleton.HasPoint({x:a.x,y:a.y})&&this._onMouseMove(a)},set Skeleton(a){this._skeleton=a},get Skeleton(){return this._skeleton}}});b._class.Primitive=c})(armlib,gizmo);(function(b,d){var c=d.Class({Extend:b._class.VisualObj,Initialize:function(a){this._setName(a.name||this.name);this.zindex=a.zindex||this.zindex;this._x=a.x||this._x;this._y=a.y||this._y;this.centralPoint=a.centralPoint||this.centralPoint;this.angle=a.angle||this.angle;this.scale=a.scale||this.scale;return this},Statics:{_type:["Object","","ArmObject"],_name:"Object "+100*Math.random(),_numberNotLoadedChilds:0,_list:[]},Methods:{addChild:function(a){a._setContext(this.context);a._setLayer(this.layer);
a._setOwner(this);this._list.push(a);this._numberNotLoadedChilds++;this._sortByZindex();return this},removeChild:function(){},Load:function(){this._load.call(this);return this},getNumberNotLoadedChilds:function(){return this._numberNotLoadedChilds},_load:function(){for(var a in this._list)this._list[a]._load.call(this._list[a]);0==this._list.length&&this.__onLoad()},_begin:function(){this.setHaveChanges();this._onBegin&&this._onBegin.call(this,this._layer,b,d);for(var a in this._list)this._list[a]._begin()},
_clear:function(){this._onClear&&this._onClear(this._context,this._layer,b,d);for(var a=this._list.length-1;0<=a;a--)this._list[a]._clear.call(this._list[a])},_update:function(){this._onUpdate&&this._onUpdate.call(this,this._layer,b,d);this.haveChanges();for(var a in this._list)this._list[a]._update()},_draw:function(){for(var a in this._list)this._list[a]._draw.call(this._list[a]);this.setHaveNotChanges()},_sortByZindex:function(){this._list=gizmo.nativeSort({mas:this._list,target:"<",field:"_zindex"})},
_loadedChild:function(){this._numberNotLoadedChilds--;0==this._numberNotLoadedChilds&&this.__onLoad()},_setContext:function(a){this._context=a;for(var b in this._list)this._list[b]._setContext(a)},_setLayer:function(a){this._layer=a;for(var b in this._list)this._list[b]._setLayer(a)},__onKeyDown:function(a){for(var b in this._list)this._list[b].__onKeyDown(a)},__onKeyPress:function(a){for(var b in this._list)this._list[b].__onKeyPress(a)},__onKeyUp:function(a){for(var b in this._list)this._list[b].__onKeyUp(a)},
__onMouseDown:function(a){for(var b in this._list)this._list[b].__onMouseDown(a)},__onMouseUp:function(a){for(var b in this._list)this._list[b].__onMouseUp(a)},__onMouseMove:function(a){for(var b in this._list)this._list[b].__onMouseMove(a)}}});b.Object=c})(armlib,gizmo);(function(b,d){var c=d.Class({Statics:{_stack:[]},Methods:{push:function(a){try{return this._stack.push(a),!0}catch(b){return!1}},pop:function(){var a=this._stack.shift();return void 0!=a?a:!1}}});b._class.EventStack=c})(armlib,gizmo);(function(b,d){var c=d.Class({Initialize:function(a){this._setName(a.name||this.name);a.fps&&(this.fps=a.fps);this.width=a.width||this.width;this.height=a.height||this.height;this._setContainerName(b.container);var c=b.container,e=document.createElement("canvas");e.width=a.width||this.width;e.height=a.height||this.height;e.id=this.name;e.style.zIndex=a.zindex||this._zindex;e.style.position="absolute";c.appendChild(e);this._canvas=e;this._context=e.getContext("2d");this._setLayer(this);this._setOwner(b);
b._addLayer(this);this._init();return this},Statics:{_type:["Layer","",""],_name:100*Math.random(),_isRuning:!1,_context:null,_layer:null,_owner:null,_container:null,_canvas:null,_width:500,_height:500,_fps:0,_zindex:0,_updating:!1,_changeList:[],_list:[],_eventStack:new b._class.EventStack,_onEachFrame:null,_cancelAnimationFrame:null,_request:null,_armlib:b,_lib:d},Methods:{run:function(){this._begin();this.run=function(){this.stop();b.ListenMouseKeyboardEvents();var a,c=this;a=function(){c._clear();
c._update();c._draw()};a();this._onEachFrame(a);this._setRunStatus(!0);return this};this.run();return this},stop:function(){this._request&&(b.NotListenMouseKeyboardEvents(),this._cancelAnimationFrame.call(window,this._request))},addChild:function(a){a.isLoaded?(a._setContext(this._context),a._setLayer(this._layer),this._list.push(a)):console.log("Object "+a.name+" don't loaded!");return this},removeChild:function(){},setFunc:function(a,b){a&&b&&(this["_"+a]=b);return this},getFunc:function(){if(name&&
func)return this["_"+name]},_init:function(){var a=this,b;if(0!=this.fps){var c=this.fps;b=function(a){this._request=setInterval(a,1E3/c)};this._cancelAnimationFrame=window.clearInterval}else window.webkitRequestAnimationFrame?b=function(b){var c=function(){b();a._request=webkitRequestAnimationFrame(c)};c()}:window.mozRequestAnimationFrame?b=function(b){var c=function(){b();a._request=mozRequestAnimationFrame(c)};c()}:window.requestAnimationFrame?b=function(b){var c=function(){b();a._request=requestAnimationFrame(c)};
c()}:window.msRequestAnimationFrame&&(b=function(b){var c=function(){b();a._request=msRequestAnimationFrame(c)};c()}),this._cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame;this._onEachFrame=b},_begin:function(){for(var a in this._list)this._list[a]._begin()},_clear:function(){for(var a=this._list.length-1;0<=a;a--)this._list[a]._clear()},_update:function(){this._doEvents();for(var a in this._list)this._list[a]._update()},_draw:function(){for(var a in this._list)this._list[a]._draw()},
_setType:function(a){this._type=a},getType:function(){return this._type},_setName:function(a){this._name=a},_setRunStatus:function(a){this._isRuning=a},getRunStatus:function(){return this._isRuning},_setContext:function(a){this._context=a},getContext:function(){return this._context},_setLayer:function(a){this._layer=a},getLayer:function(){return this._layer},_setOwner:function(a){this._owner=a},_getOwner:function(){return this._owner},_setContainerName:function(a){this._container=a},_getContainerName:function(){return this._container},
_doEvents:function(){for(var a;a=this._eventStack.pop();)switch(a.name){case "onKeyDown":this.__onKeyDown(a.e);break;case "onKeyPress":this.__onKeyPress(a.e);break;case "onKeyUp":this.__onKeyUp(a.e);break;case "onMouseDown":this.__onMouseDown(a.e);break;case "onMouseUp":this.__onMouseUp(a.e);break;case "onMouseMove":this.__onMouseMove(a.e)}},__onKeyDown:function(a){this._onKeyDown&&this._onKeyDown(a);if(this.getRunStatus())for(var b in this._list)this._list[b].__onKeyDown(a)},__onKeyPress:function(a){this._onKeyPress&&
this._onKeyPress(a);if(this.getRunStatus())for(var b in this._list)this._list[b].__onKeyPress(a)},__onKeyUp:function(a){this._onKeyUp&&this._onKeyUp(a);if(this.getRunStatus())for(var b in this._list)this._list[b].__onKeyUp(a)},__onMouseDown:function(a){this._onMouseDown&&this._onMouseDown(a);if(this.getRunStatus())for(var b in this._list)this._list[b].__onMouseDown(a)},__onMouseUp:function(a){this._onMouseUp&&this._onMouseUp(a);if(this.getRunStatus())for(var b in this._list)this._list[b].__onMouseUp(a)},
__onMouseMove:function(a){this._onMouseMove&&this._onMouseMove(a);if(this.getRunStatus())for(var b in this._list)this._list[b].__onMouseMove(a)},get name(){return this._name},set width(a){this._width=a},get width(){return this._width},set height(a){this._height=a},get height(){return this._height},set fps(a){this._fps=a;this.getRunStatus()?(this.stop(),this._init(),this.run()):this._init()},get fps(){return this._fps},set zindex(a){this._zindex=a;this._canvas.style["z-index"]=a},get zindex(){return this._zindex}}});
b.Layer=c})(armlib,gizmo);(function(b,d){var c=d.Class({Extend:b._class.Primitive,Initialize:function(a){this._setName(a.name||this.name);this.zindex=a.zindex||this.zindex;this.x=a.x||this.x;this.y=a.y||this.y;this.centralPoint=a.centralPoint||this.centralPoint;this.width=a.width||this.width;this.height=a.height||this.height;this.angle=a.angle||this.angle;this.scale=a.scale||this.scale;this.fill=a.fill||this.fill;this.globalAlpha=a.globalAlpha||this.globalAlpha;this.stroke=a.stroke||this.stroke;this.lineWidth=a.lineWidth||
this.lineWidth;return this},Statics:{_type:["Rect","Primitive","ArmObject"],_name:"Rect "+100*Math.random(),_width:10,_height:10,_lineWidth:1,_loaded:!1},Methods:{_load:function(){this._setLoaded();this.__onLoad.call(this);return this},_draw:function(){this._context.save();this._context.beginPath();this._context.globalAlpha=this.globalAlpha;this._context.strokeStyle=this.stroke;this._context.fillStyle=this.fill;this._context.lineWidth=this.lineWidth;var a=this.ParamsTransformMatrix;this._context.setTransform(a.a,
a.b,a.c,a.d,a.e,a.f);this._context.rect(this.x,this.y,this.width,this.height);this._context.closePath();this._context.stroke();this._context.fill();this._context.restore();this.setHaveNotChanges()},updateDrawingRectPos:function(){var a=this.TransformMatrix,b=new gizmo.Math.Matrix([[this.x,this.x+this.width,this.x+this.width,this.x],[this.y,this.y,this.y+this.height,this.y+this.height],[1,1,1,1]]),c=a.x(b).elements,a=Math.floor(Math.min(c[0][0],c[0][1],c[0][2],c[0][3]))-this.lineWidth,b=Math.floor(Math.min(c[1][0],
c[1][1],c[1][2],c[1][3]))-this.lineWidth,d=Math.ceil(Math.max(c[0][0],c[0][1],c[0][2],c[0][3])-a)+this.lineWidth,c=Math.ceil(Math.max(c[1][0],c[1][1],c[1][2],c[1][3])-b)+this.lineWidth;this._drawRect.drawingRectPos={p0:{x:a,y:b},p1:{x:d,y:c}}},set lineWidth(a){this._lineWidth=a},get lineWidth(){return this._lineWidth}}});b.Rect=c})(armlib,gizmo);(function(b,d){var c=d.Class({Extend:b._class.Primitive,Initialize:function(a){this._setName(a.name||this.name);this.src=a.src||this.src;this.zindex=a.zindex||this.zindex;this.x=a.x||this.x;this.y=a.y||this.y;this.centralPoint=a.centralPoint||this.centralPoint;this.width=a.width||this.width;this.height=a.height||this.height;this.angle=a.angle||this.angle;this.scale=a.scale||this.scale;this.fill=a.fill||this.fill;this.globalAlpha=a.globalAlpha||this.globalAlpha;this.stroke=a.stroke||this.stroke;return this},
Statics:{_type:["Image","Primitive","ArmObject"],_name:"Image "+100*Math.random(),_width:10,_height:10,_src:null,_image:null,_loaded:!1},Methods:{_load:function(){this.image=new Image;this.image.src=this.src;var a=this;this.image.onload=function(){a._setLoaded();a.__onLoad.call(a)};return this},_draw:function(){this._context.save();this._context.beginPath();this._context.globalAlpha=this.globalAlpha;var a=this.ParamsTransformMatrix;this._context.setTransform(a.a,a.b,a.c,a.d,a.e,a.f);this._context.drawImage(this.image,
this.x,this.y,this.width,this.height);this._context.closePath();this._context.restore();this.setHaveNotChanges()},set image(a){this._image=a},get image(){return this._image},set src(a){this._src=a},get src(){return this._src}}});b.Image=c})(armlib,gizmo);(function(b,d){var c=d.Class({Extend:b._class.Primitive,Initialize:function(a){this._setName(a.name||this.name);this.zindex=a.zindex||this.zindex;this.x=a.x1||this.x;this.y=a.y1||this.y;this.x2=a.x2||this.x2;this.y2=a.y2||this.y2;this.centralPoint=a.centralPoint||this.centralPoint;this.angle=a.angle||this.angle;this.scale=a.scale||this.scale;this.globalAlpha=a.globalAlpha||this.globalAlpha;this.stroke=a.stroke||this.stroke;this.lineWidth=a.lineWidth||this.lineWidth;return this},Statics:{_type:["Line",
"Primitive","ArmObject"],_name:"Line "+100*Math.random(),_x2:10,_y2:10,_lineWidth:1,_loaded:!1},Methods:{_load:function(){this._setLoaded();this.__onLoad.call(this);return this},_draw:function(){this._context.save();this._context.beginPath();this._context.globalAlpha=this.globalAlpha;this._context.strokeStyle=this.stroke;this._context.fillStyle=this.fill;this._context.lineWidth=this.lineWidth;var a=this.ParamsTransformMatrix;this._context.setTransform(a.a,a.b,a.c,a.d,a.e,a.f);this._context.moveTo(this.x,
this.y);this._context.lineTo(this.x2,this.y2);this._context.closePath();this._context.stroke();this._context.restore();this.setHaveNotChanges()},updateDrawingRectPos:function(){var a=this.TransformMatrix,b=new gizmo.Math.Matrix([[this.x,this.x2,this.x2,this.x],[this.y,this.y,this.y2,this.y2],[1,1,1,1]]),c=a.x(b).elements,a=Math.floor(Math.min(c[0][0],c[0][1],c[0][2],c[0][3]))-this.lineWidth,b=Math.floor(Math.min(c[1][0],c[1][1],c[1][2],c[1][3]))-this.lineWidth,d=Math.ceil(Math.max(c[0][0],c[0][1],
c[0][2],c[0][3])-a)+this.lineWidth,c=Math.ceil(Math.max(c[1][0],c[1][1],c[1][2],c[1][3])-b)+this.lineWidth;this._drawRect.drawingRectPos={p0:{x:a,y:b},p1:{x:d,y:c}}},set lineWidth(a){this._lineWidth=a},get lineWidth(){return this._lineWidth},set x2(a){this._x2=a},get x2(){return this._x2},set y2(a){this._y2=a},get y2(){return this._y2}}});b.Line=c})(armlib,gizmo);(function(b,d){var c=d.Class({Extend:b._class.Primitive,Initialize:function(a){this._setName(a.name||this.name);this.zindex=a.zindex||this.zindex;this.x=a.x||this.x;this.y=a.y||this.y;this.radius=a.radius||this.radius;this.centralPoint=a.centralPoint||this.centralPoint;this.scale=a.scale||this.scale;this.fill=a.fill||this.fill;this.globalAlpha=a.globalAlpha||this.globalAlpha;this.stroke=a.stroke||this.stroke;this.lineWidth=a.lineWidth||this.lineWidth;return this},Statics:{_type:["Circle","Primitive",
"ArmObject"],_name:"Circle "+100*Math.random(),_radius:10,_lineWidth:1,_loaded:!1},Methods:{_load:function(){this._setLoaded();this.__onLoad.call(this);return this},_draw:function(){this._context.save();this._context.beginPath();this._context.globalAlpha=this.globalAlpha;this._context.strokeStyle=this.stroke;this._context.fillStyle=this.fill;this._context.lineWidth=this.lineWidth;var a=this.ParamsTransformMatrix;this._context.setTransform(a.a,a.b,a.c,a.d,a.e,a.f);this.context.arc(this.x,this.y,this.radius,
0,2*Math.PI,!1);this._context.closePath();this._context.stroke();this._context.fill();this._context.restore();this.setHaveNotChanges()},updateDrawingRectPos:function(){var a=this.TransformMatrix,b=new gizmo.Math.Matrix([[this.x-this.radius,this.x+this.radius,this.x+this.radius,this.x-this.radius],[this.y-this.radius,this.y-this.radius,this.y+this.radius,this.y+this.radius],[1,1,1,1]]),c=a.x(b).elements,a=Math.floor(Math.min(c[0][0],c[0][1],c[0][2],c[0][3]))-this.lineWidth,b=Math.floor(Math.min(c[1][0],
c[1][1],c[1][2],c[1][3]))-this.lineWidth,d=Math.ceil(Math.max(c[0][0],c[0][1],c[0][2],c[0][3])-a)+this.lineWidth,c=Math.ceil(Math.max(c[1][0],c[1][1],c[1][2],c[1][3])-b)+this.lineWidth;this._drawRect.drawingRectPos={p0:{x:a,y:b},p1:{x:d,y:c}}},set lineWidth(a){this._lineWidth=a},get lineWidth(){return this._lineWidth},set radius(a){this._radius=a},get radius(){return this._radius}}});b.Circle=c})(armlib,gizmo);
